<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>팀 점수 관리</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f4f4f4;
        }
        input[type="number"] {
            width: 50px;
        }
    </style>
    <script type="module">
        // Firebase 설정
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
        import { getDatabase, ref, set, get, onValue, update } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "YOUR_API_KEY", // 자신의 Firebase API 키로 대체하세요.
            authDomain: "team-score-manager.firebaseapp.com",
            databaseURL: "https://team-score-manager-default-rtdb.firebaseio.com/",
            projectId: "team-score-manager",
            storageBucket: "team-score-manager.appspot.com",
            messagingSenderId: "566490541048",
            appId: "1:566490541048:web:050eb2f4984872da91440d",
            measurementId: "G-4DH92WNSPF"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const teamsRef = ref(db, "teams");

        // 팀 추가 함수
        async function addTeam() {
            const teamName = document.getElementById("teamName").value.trim();
            if (!teamName) {
                console.error("팀 이름이 비어 있습니다.");
                return;
            }

            const newTeam = {
                name: teamName,
                scores: [0, 0, 0, 0, 0],
                total: 0
            };

            try {
                await update(teamsRef, { [teamName]: newTeam });
                console.log("팀 추가 성공:", newTeam);
            } catch (error) {
                console.error("팀 추가 실패:", error);
            }

            document.getElementById("teamName").value = "";
        }

        // 점수 업데이트 함수
        async function updateScore(teamName, gameIndex, value) {
            try {
                const snapshot = await get(teamsRef);
                if (snapshot.exists()) {
                    const teams = snapshot.val();
                    if (teams[teamName]) {
                        teams[teamName].scores[gameIndex] = parseInt(value) || 0;
                        teams[teamName].total = teams[teamName].scores.reduce((a, b) => a + b, 0);
                        await update(teamsRef, { [teamName]: teams[teamName] });
                    }
                }
            } catch (error) {
                console.error("점수 업데이트 실패:", error);
            }
        }

        // 데이터 초기화 함수
        async function resetScores() {
            try {
                const snapshot = await get(teamsRef);
                if (snapshot.exists()) {
                    const teams = snapshot.val();
                    for (let teamName in teams) {
                        teams[teamName].scores = [0, 0, 0, 0, 0];
                        teams[teamName].total = 0;
                    }
                    await set(teamsRef, teams);
                    console.log("데이터 초기화 성공");
                }
            } catch (error) {
                console.error("데이터 초기화 실패:", error);
            }
        }

        // 실시간 데이터 테이블 업데이트
        function updateTable() {
            onValue(teamsRef, (snapshot) => {
                if (snapshot.exists()) {
                    const teams = Object.values(snapshot.val()).sort((a, b) => b.total - a.total);
                    const tbody = document.getElementById("scoreTable").querySelector("tbody");
                    tbody.innerHTML = "";

                    teams.forEach((team, index) => {
                        const row = tbody.insertRow();
                        row.insertCell().textContent = index + 1;
                        row.insertCell().textContent = team.name;

                        team.scores.forEach((score, gameIndex) => {
                            const cell = row.insertCell();
                            const input = document.createElement("input");
                            input.type = "number";
                            input.value = score;
                            input.oninput = (e) => updateScore(team.name, gameIndex, e.target.value);
                            cell.appendChild(input);
                        });

                        row.insertCell().textContent = team.total;
                    });
                }
            });
        }

        // 페이지 로드 시 테이블 업데이트 시작
        window.onload = updateTable;
    </script>
</head>
<body>
    <h1>팀 점수 관리 시스템</h1>
    <input type="text" id="teamName" placeholder="팀 이름 입력">
    <button onclick="addTeam()">팀 추가</button>
    <button onclick="resetScores()">초기화</button>

    <table id="scoreTable">
        <thead>
            <tr>
                <th>순위</th>
                <th>팀 이름</th>
                <th>게임1</th>
                <th>게임2</th>
                <th>게임3</th>
                <th>게임4</th>
                <th>게임5</th>
                <th>합계</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</body>
</html>
